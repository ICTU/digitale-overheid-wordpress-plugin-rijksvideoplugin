window.CMB2=window.CMB2||{},function(e,t,a,i,r){"use strict";var n=e.cmb2_l10,o=e.setTimeout,c,d=function(e){return a(t.getElementById(e))},l={idNumber:!1,repeatEls:'input:not([type="button"],[id^=filelist]),select,textarea,.cmb2-media-status',noEmpty:'input:not([type="button"]):not([type="radio"]):not([type="checkbox"]),textarea',repeatUpdate:'input:not([type="button"]),select,textarea,label',styleBreakPoint:450,mediaHandlers:{},defaults:{time_picker:n.defaults.time_picker,date_picker:n.defaults.date_picker,color_picker:n.defaults.color_picker||{},code_editor:n.defaults.code_editor},media:{frames:{}}};i.metabox=function(){return i.$metabox?i.$metabox:(i.$metabox=a(".cmb2-wrap > .cmb2-metabox"),i.$metabox)},i.init=function(){c=a(t),a.extend(i,l),i.trigger("cmb_pre_init");var r=i.metabox(),s=r.find(".cmb-repeatable-group");i.initPickers(r.find('input[type="text"].cmb2-timepicker'),r.find('input[type="text"].cmb2-datepicker'),r.find('input[type="text"].cmb2-colorpicker')),i.initCodeEditors(r.find(".cmb2-textarea-code:not(.disable-codemirror)")),a('<p><span class="button-secondary cmb-multicheck-toggle">'+n.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)"),i.makeListSortable(),i.makeRepeatableSortable(),r.on("change",".cmb2_upload_file",function(){i.media.field=a(this).attr("id"),d(i.media.field+"_id").val("")}).on("click",".cmb-multicheck-toggle",i.toggleCheckBoxes).on("click",".cmb2-upload-button",i.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",i.handleFileClick).on("click",".cmb2-remove-file-button",i.handleRemoveMedia).on("click",".cmb-add-group-row",i.addGroupRow).on("click",".cmb-add-row-button",i.addAjaxRow).on("click",".cmb-remove-group-row",i.removeGroupRow).on("click",".cmb-remove-row-button",i.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",i.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",i.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",i.toggleHandle),s.length&&s.on("cmb2_add_row",i.emptyValue).on("cmb2_add_row",i.setDefaults).filter(".sortable").each(function(){a(this).find(".cmb-remove-group-row-button").before('<a class="button-secondary cmb-shift-rows move-up alignleft" href="#"><span class="'+n.up_arrow_class+'"></span></a> <a class="button-secondary cmb-shift-rows move-down alignleft" href="#"><span class="'+n.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",i.shiftRows),o(i.resizeoEmbeds,500),a(e).on("resize",i.resizeoEmbeds),d("addtag").length&&i.listenTagAdd(),a(t).on("cmb_init",i.mceEnsureSave),i.trigger("cmb_init")},i.mceEnsureSave=function(){wp.data&&wp.data.hasOwnProperty("subscribe")&&i.canTinyMCE()&&wp.data.subscribe(function(){if(wp.data.select("core/editor").isSavingPost()&&e.tinyMCE.editors.length)for(var t=0;t<e.tinyMCE.editors.length;t++)e.tinyMCE.editors[t].save()})},i.canTinyMCE=function(){return n.user_can_richedit&&e.tinyMCE},i.listenTagAdd=function(){c.ajaxSuccess(function(e,t,a){a.data&&a.data.length&&-1!==a.data.indexOf("action=add-tag")&&i.resetBoxes(d("addtag").find(".cmb2-wrap > .cmb2-metabox"))})},i.resetBoxes=function(e){a.each(e,function(){i.resetBox(a(this))})},i.resetBox=function(e){e.find(".wp-picker-clear").trigger("click"),e.find(".cmb2-remove-file-button").trigger("click"),e.find(".cmb-row.cmb-repeatable-grouping:not(:first-of-type) .cmb-remove-group-row").click(),e.find(".cmb-repeat-row:not(:first-child)").remove(),e.find('input:not([type="button"]),select,textarea').each(function(){var e=a(this),t=e.prop("tagName");if("INPUT"===t){var i=e.attr("type");"checkbox"===i||"radio"===i?e.prop("checked",!1):e.val("")}"SELECT"===t&&a("option:selected",this).prop("selected",!1),"TEXTAREA"===t&&e.html("")})},i.resetTitlesAndIterator=function(e){e.group&&a(".cmb-repeatable-group.repeatable").each(function(){var e=a(this),t=e.find(".cmb-add-group-row").data("grouptitle");e.find(".cmb-repeatable-grouping").each(function(e){var i=a(this),r=i.find("h3.cmb-group-title");i.data("iterator",e),r.length&&r.text(t.replace("{#}",e+1))})})},i.toggleHandle=function(e){e.preventDefault(),i.trigger("postbox-toggled",a(this).parent(".postbox").toggleClass("closed"))},i.toggleCheckBoxes=function(e){e.preventDefault();var t=a(this),i=t.closest(".cmb-td").find("input[type=checkbox]:not([disabled])");t.data("checked")?(i.prop("checked",!1),t.data("checked",!1)):(i.prop("checked",!0),t.data("checked",!0))},i.handleMedia=function(e){e.preventDefault();var t=a(this);i.attach_id=!t.hasClass("cmb2-upload-list")&&t.closest(".cmb-td").find(".cmb2-upload-file-id").val(),i.attach_id="0"!==i.attach_id&&i.attach_id,i._handleMedia(t.prev("input.cmb2-upload-file").attr("id"),t.hasClass("cmb2-upload-list"))},i.handleFileClick=function(e){if(!a(e.target).is("a")){e.preventDefault();var t=a(this),r=t.closest(".cmb-td"),n=r.find(".cmb2-upload-button").hasClass("cmb2-upload-list");i.attach_id=n?t.find('input[type="hidden"]').data("id"):r.find(".cmb2-upload-file-id").val(),i.attach_id&&i._handleMedia(r.find("input.cmb2-upload-file").attr("id"),n,i.attach_id)}},i._handleMedia=function(e,t){if(wp){var r,o;if(o=i.mediaHandlers,(r=i.media).field=e,r.$field=d(r.field),r.fieldData=r.$field.data(),r.previewSize=r.fieldData.previewsize,r.sizeName=r.fieldData.sizename,r.fieldName=r.$field.attr("name"),r.isList=t,e in r.frames)return r.frames[e].open();r.frames[e]=wp.media({title:i.metabox().find('label[for="'+e+'"]').text(),library:r.fieldData.queryargs||{},button:{text:n.strings[t?"upload_files":"upload_file"]},multiple:!!t&&"add"}),r.frames[e].states.first().set("filterable","all"),i.trigger("cmb_media_modal_init",r),o.list=function(e,t){var a=[],i;if(o.list.templates||(o.list.templates={image:wp.template("cmb2-list-image"),file:wp.template("cmb2-list-file")}),e.each(function(e){i=o.getAttachmentHtml(e,"list"),a.push(i)}),t)return a;r.$field.siblings(".cmb2-media-status").append(a)},o.single=function(e){o.single.templates||(o.single.templates={image:wp.template("cmb2-single-image"),file:wp.template("cmb2-single-file")});var t=e.first();r.$field.val(t.get("url")),d(r.field+"_id").val(t.get("id"));var a=o.getAttachmentHtml(t,"single");r.$field.siblings(".cmb2-media-status").slideDown().html(a)},o.getAttachmentHtml=function(e,t){var a="image"===e.get("type"),i=o.prepareData(e,a);return o[t].templates[a?"image":"file"](i)},o.prepareData=function(e,t){return t&&o.getImageData.call(e,50),(e=e.toJSON()).mediaField=r.field,e.mediaFieldName=r.fieldName,e.stringRemoveImage=n.strings.remove_image,e.stringFile=n.strings.file,e.stringDownload=n.strings.download,e.stringRemoveFile=n.strings.remove_file,e},o.getImageData=function(e){var t=r.previewSize[0]||e,a=r.previewSize[1]||e,i=this.get("url"),n=this.get("width"),o=this.get("height"),c=this.get("sizes");return c&&(c[r.sizeName]?(i=c[r.sizeName].url,n=c[r.sizeName].width,o=c[r.sizeName].height):c.large&&(i=c.large.url,n=c.large.width,o=c.large.height)),n>t&&(o=Math.floor(t*o/n),n=t),o>a&&(n=Math.floor(a*n/o),o=a),n||(n=t),o||(o="svg"===this.get("filename").split(".").pop()?"100%":a),this.set("sizeUrl",i),this.set("sizeWidth",n),this.set("sizeHeight",o),this},o.selectFile=function(){var n=r.frames[e].state().get("selection"),c=t?"list":"single";i.attach_id&&t?a('[data-id="'+i.attach_id+'"]').parents("li").replaceWith(o.list(n,!0)):o[c](n),i.trigger("cmb_media_modal_select",n,r)},o.openModal=function(){var t=r.frames[e].state().get("selection"),a;i.attach_id?((a=wp.media.attachment(i.attach_id)).fetch(),t.set(a?[a]:[])):t.reset(),i.trigger("cmb_media_modal_open",t,r)},r.frames[e].on("select",o.selectFile).on("open",o.openModal),r.frames[e].open()}},i.handleRemoveMedia=function(e){e.preventDefault();var r=a(this);return r.is(".cmb-attach-list .cmb2-remove-file-button")?(r.parents(".cmb2-media-item").remove(),!1):(i.media.field=r.attr("rel"),i.metabox().find(t.getElementById(i.media.field)).val(""),i.metabox().find(t.getElementById(i.media.field+"_id")).val(""),r.parents(".cmb2-media-status").html(""),!1)},i.cleanRow=function(e,t,r){var n=e.find(i.repeatUpdate);if(r){var o=e.find("[id]").not(i.repeatUpdate);e.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove(),o.length&&o.each(function(){var r=a(this),n=r.attr("id"),o=n.replace("_"+t,"_"+i.idNumber),c=e.find('[data-selector="'+n+'"]');r.attr("id",o),c.length&&c.attr("data-selector",o).data("selector",o)})}return n.filter(":checked").removeAttr("checked"),n.find(":checked").removeAttr("checked"),n.filter(":selected").removeAttr("selected"),n.find(":selected").removeAttr("selected",!1),e.find("h3.cmb-group-title").length&&e.find("h3.cmb-group-title").text(e.data("title").replace("{#}",i.idNumber+1)),n.each(function(){i.elReplacements(a(this),t,r)}),i},i.elReplacements=function(e,t,a){var r=e.attr("for"),n=e.val(),o=e.prop("type"),c=i.getFieldArg(e,"default"),d=void 0!==c&&!1!==c?c:"",l=e.prop("tagName"),s=("radio"===o||"checkbox"===o)&&n,p={},m,u;if(r)p={for:r.replace("_"+t,"_"+i.idNumber)};else{var f=e.attr("name"),b;u=e.attr("id"),a?(b=f?f.replace("["+t+"][","["+i.idNumber+"]["):"",m=u?u.replace("_"+t+"_","_"+i.idNumber+"_"):""):(b=f?i.replaceLast(f,"["+t+"]","["+i.idNumber+"]"):"",m=u?i.replaceLast(u,"_"+t,"_"+i.idNumber):""),p={id:m,name:b}}if("TEXTAREA"===l&&e.html(d),"SELECT"===l&&void 0!==typeof c){var h=e.find('[value="'+c+'"]');h.length&&h.attr("selected","selected").prop("selected","selected")}return s&&(e.removeAttr("checked"),void 0!==typeof c&&n===c&&e.attr("checked","checked").prop("checked","checked")),!a&&e[0].hasAttribute("data-iterator")&&(p["data-iterator"]=i.idNumber),e.removeClass("hasDatepicker").val(s||d).attr(p),e},i.newRowHousekeeping=function(e){var t=e.find(".wp-picker-container"),r=e.find(".cmb2-media-status");return t.length&&t.each(function(){var e=a(this).parent();e.html(e.find('input[type="text"].cmb2-colorpicker').attr("style",""))}),r.length&&r.empty(),i},i.afterRowInsert=function(e){i.initPickers(e.find('input[type="text"].cmb2-timepicker'),e.find('input[type="text"].cmb2-datepicker'),e.find('input[type="text"].cmb2-colorpicker'))},i.updateNameAttr=function(){var e=a(this),t=e.attr("name");if(void 0!==t){var i=parseInt(e.parents(".cmb-repeatable-grouping").data("iterator"),10),r=i-1,n=t.replace("["+i+"]","["+r+"]");e.attr("name",n)}},i.emptyValue=function(e,t){a(i.noEmpty,t).val("")},i.setDefaults=function(e,t){a(i.noEmpty,t).each(function(){var e=a(this),t=i.getFieldArg(e,"default");void 0!==t&&!1!==t&&e.val(t)})},i.addGroupRow=function(e){e.preventDefault();var t=a(this);i.triggerElement(t,"cmb2_add_group_row_start",t);var r=d(t.data("selector")),n=r.find(".cmb-repeatable-grouping").last(),o=parseInt(n.data("iterator"),10);i.idNumber=parseInt(o,10)+1;for(var c=n.clone(),l=c.prop("nodeName")||"div";r.find('.cmb-repeatable-grouping[data-iterator="'+i.idNumber+'"]').length>0;)i.idNumber++;i.newRowHousekeeping(c.data("title",t.data("grouptitle"))).cleanRow(c,o,!0),c.find(".cmb-add-row-button").prop("disabled",!1);var s=a("<"+l+' class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+i.idNumber+'">'+c.html()+"</"+l+">");n.after(s),i.afterRowInsert(s),i.triggerElement(r,{type:"cmb2_add_row",group:!0},s)},i.addAjaxRow=function(e){e.preventDefault();var t=a(this),r=d(t.data("selector")),n=r.find(".empty-row"),o=parseInt(n.find("[data-iterator]").data("iterator"),10);i.idNumber=parseInt(o,10)+1;var c=n.clone();i.newRowHousekeeping(c).cleanRow(c,o),n.removeClass("empty-row hidden").addClass("cmb-repeat-row"),n.after(c),i.afterRowInsert(c),i.triggerElement(r,{type:"cmb2_add_row",group:!1},c)},i.removeGroupRow=function(e){e.preventDefault();var t=a(this),r=d(t.data("selector")),n=t.parents(".cmb-repeatable-grouping"),o;if(r.find(".cmb-repeatable-grouping").length<2)return i.resetRow(n.parents(".cmb-repeatable-group").find(".cmb-add-group-row"),t);i.triggerElement(r,"cmb2_remove_group_row_start",t),n.nextAll(".cmb-repeatable-grouping").find(i.repeatEls).each(i.updateNameAttr),n.remove(),i.triggerElement(r,{type:"cmb2_remove_row",group:!0})},i.removeAjaxRow=function(e){e.preventDefault();var t=a(this);if(!t.hasClass("button-disabled")){var r=t.parents(".cmb-row"),n=t.parents(".cmb-repeat-table"),o;if(n.find(".cmb-row").length<=2)return i.resetRow(r.find(".cmb-add-row-button"),t);r.hasClass("empty-row")&&r.prev().addClass("empty-row").removeClass("cmb-repeat-row"),t.parents(".cmb-repeat-table .cmb-row").remove(),i.triggerElement(n,{type:"cmb2_remove_row",group:!1})}},i.resetRow=function(e,t){e.trigger("click"),t.trigger("click")},i.shiftRows=function(e){e.preventDefault();var t=a(this),r=t.parents(".cmb-repeatable-grouping"),n=t.hasClass("move-up")?r.prev(".cmb-repeatable-grouping"):r.next(".cmb-repeatable-grouping");if(i.triggerElement(t,"cmb2_shift_rows_enter",t,r,n),n.length){i.triggerElement(t,"cmb2_shift_rows_start",t,r,n);var o=[];r.find(i.repeatEls).each(function(){var e=a(this),t=e.attr("type"),i;i=e.hasClass("cmb2-media-status")?e.html():"checkbox"===t||"radio"===t?e.is(":checked"):"select"===e.prop("tagName")?e.is(":selected"):e.val(),o.push({val:i,$:e})}),n.find(i.repeatEls).each(function(e){var t=a(this),i=t.attr("type"),r;if(t.hasClass("cmb2-media-status")){var n=t.closest(".cmb-repeatable-grouping").attr("data-iterator"),c=o[e].$.closest(".cmb-repeatable-grouping").attr("data-iterator");r=t.html(),t.html(o[e].val),o[e].$.html(r),o[e].$.find("input").each(function(){var e=a(this).attr("name");e=e.replace("["+n+"]","["+c+"]"),a(this).attr("name",e)}),t.find("input").each(function(){var e=a(this).attr("name");e=e.replace("["+c+"]","["+n+"]"),a(this).attr("name",e)})}else"checkbox"===i?(o[e].$.prop("checked",t.is(":checked")),t.prop("checked",o[e].val)):"radio"===i?(t.is(":checked")&&o[e].$.attr("data-checked","true"),o[e].$.is(":checked")&&t.attr("data-checked","true")):"select"===t.prop("tagName")?(o[e].$.prop("selected",t.is(":selected")),t.prop("selected",o[e].val)):(o[e].$.val(t.val()),t.val(o[e].val))}),r.find("input[data-checked=true]").prop("checked",!0).removeAttr("data-checked"),n.find("input[data-checked=true]").prop("checked",!0).removeAttr("data-checked"),r.find('input[type="text"].cmb2-colorpicker').trigger("change"),n.find('input[type="text"].cmb2-colorpicker').trigger("change"),i.triggerElement(t,"cmb2_shift_rows_complete",t,r,n)}},i.initPickers=function(e,t,a){i.initDateTimePickers(e,"timepicker","time_picker"),i.initDateTimePickers(t,"datepicker","date_picker"),i.initColorPickers(a)},i.initDateTimePickers=function(e,t,r){e.length&&e[t]("destroy").each(function(){var e=a(this),n=e.data(t)||{},o=a.extend({},i.defaults[r],n);e[t](i.datePickerSetupOpts(n,o,t))})},i.datePickerSetupOpts=function(e,t,r){var n=a.extend({},t);return t.beforeShow=function(e,t){"timepicker"===r&&i.addTimePickerClasses(t.dpDiv),d("ui-datepicker-div").addClass("cmb2-element"),"function"==typeof n.beforeShow&&n.beforeShow(e,t)},"timepicker"===r&&(t.onChangeMonthYear=function(e,t,a,r){i.addTimePickerClasses(a.dpDiv),"function"==typeof n.onChangeMonthYear&&n.onChangeMonthYear(e,t,a,r)}),t.onClose=function(e,t){var i=d("ui-datepicker-div").removeClass("cmb2-element").hide();"timepicker"!==r||a(t.input).val()||t.input.val(i.find(".ui_tpicker_time").text()),"function"==typeof n.onClose&&n.onClose(e,t)},t},i.addTimePickerClasses=function(e){var t=i.addTimePickerClasses;t.count=t.count||0,o(function(){e.find(".ui-priority-secondary").length?(e.find(".ui-priority-secondary").addClass("button-secondary"),e.find(".ui-priority-primary").addClass("button-primary"),t.count=0):t.count<5&&(t.count++,t(e))},10)},i.initColorPickers=function(e){e.length&&("object"==typeof jQuery.wp&&"function"==typeof jQuery.wp.wpColorPicker?e.each(function(){var e=a(this),t=e.data("colorpicker")||{};e.wpColorPicker(a.extend({},i.defaults.color_picker,t))}):e.each(function(e){a(this).after('<div id="picker-'+e+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>'),d("picker-"+e).hide().farbtastic(a(this))}).focus(function(){a(this).next().show()}).blur(function(){a(this).next().hide()}))},i.initCodeEditors=function(e){i.defaults.code_editor&&wp&&wp.codeEditor&&e.length&&e.each(function(){wp.codeEditor.initialize(this.id,i.codeEditorArgs(a(this).data("codeeditor")))})},i.codeEditorArgs=function(e){var t=["codemirror","csslint","jshint","htmlhint"],r=a.extend({},i.defaults.code_editor);e=e||{};for(var n=t.length-1;n>=0;n--)e.hasOwnProperty(t[n])&&(r[t[n]]=a.extend({},r[t[n]]||{},e[t[n]]));return r},i.makeListSortable=function(){var e=i.metabox().find(".cmb2-media-status.cmb-attach-list");e.length&&e.sortable({cursor:"move"}).disableSelection()},i.makeRepeatableSortable=function(){var e=i.metabox().find(".cmb-repeat-table .cmb-field-list");e.length&&e.sortable({items:".cmb-repeat-row",cursor:"move"})},i.maybeOembed=function(e){var t=a(this),r;({focusout:function(){o(function(){i.spinner(".cmb2-metabox",!0)},2e3)},keyup:function(){var a=function(t,a){return e.which<=a&&e.which>=t};(a(48,90)||a(96,111)||a(8,9)||187===e.which||190===e.which)&&i.doAjax(t,e)},paste:function(){o(function(){i.doAjax(t)},100)}})[e.type]()},i.resizeoEmbeds=function(){i.metabox().each(function(){var e=a(this),t=e.parents(".inside"),r=e.parents(".inner-sidebar").length||e.parents("#side-sortables").length,n=r,o=!1;if(!t.length)return!0;var c=t.width();i.styleBreakPoint>c&&(n=!0,o=i.styleBreakPoint-62>c);var d=(c=n?c:Math.round(.82*t.width()*.97))-30;if(!n||r||o||(d-=75),d>639)return!0;var l,s=e.find(".cmb-type-oembed .embed-status").children().not(".cmb2-remove-wrapper");if(!s.length)return!0;s.each(function(){var e=a(this),t=e.width(),i=e.height(),r=d;e.parents(".cmb-repeat-row").length&&!n&&(r=d-91,r=785>c?r-15:r);var o=Math.round(r*i/t);e.width(r).height(o)})})},i.log=function(){n.script_debug&&console&&"function"==typeof console.log&&console.log.apply(console,arguments)},i.spinner=function(e,t){var i=t?"removeClass":"addClass";a(".cmb-spinner",e)[i]("is-active")},i.doAjax=function(e){var t=e.val();if(!(t.length<6)){var r=e.attr("id"),c=e.closest(".cmb-td"),d=c.find(".embed-status"),l=c.find(".embed_wrap"),s=d.find(":first-child"),p=d.length&&s.length?s.width():e.width();i.log("oembed_url",t,r),i.spinner(c),l.html(""),o(function(){a(".cmb2-oembed:focus").val()===t&&a.ajax({type:"post",dataType:"json",url:n.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:t,oembed_width:p>300?p:300,field_id:r,object_id:e.data("objectid"),object_type:e.data("objecttype"),cmb2_ajax_nonce:n.ajax_nonce},success:function(e){i.log(e),i.spinner(c,!0),l.html(e.data)}})},500)}},i.trigger=function(e){var t=Array.prototype.slice.call(arguments,1);t.push(i),c.trigger(e,t)},i.triggerElement=function(e,t){var a=Array.prototype.slice.call(arguments,2);a.push(i),e.trigger(t,a)},i.replaceLast=function(e,t,a){var i=e.lastIndexOf(t);return e.slice(0,i)+e.slice(i).replace(t,a)},i.getFieldArg=function(e,t){return i.getField(e)[t]},i.getField=function(e){return(e=e instanceof jQuery?e.data("hash"):e)&&n.fields[e]?n.fields[e]:{}},a(i.init)}(window,document,jQuery,window.CMB2);