window.CMB2=window.CMB2||{},window.CMB2.wysiwyg=window.CMB2.wysiwyg||{},function(i,t,e,n,d,o){"use strict";function r(){0===f.length?l.forEach(function(i){l.splice(l.indexOf(i),1),d.init.apply(d,i)}):i.setTimeout(r,100)}function a(){f.forEach(function(i){f.splice(f.indexOf(i),1),d.destroy(i)})}function c(i){var t=i.groupid,n=i.fieldid;return u[t]&&u[t][n]||(u[t]=u[t]||{},u[t][n]={template:wp.template("cmb2-wysiwyg-"+t+"-"+n),defaults:{mce:e.extend({},tinyMCEPreInit.mceInit["cmb2_i_"+t+n]),qt:e.extend({},tinyMCEPreInit.qtInit["cmb2_i_"+t+n])}},delete tinyMCEPreInit.mceInit["cmb2_i_"+t+n],delete tinyMCEPreInit.qtInit["cmb2_i_"+t+n]),u[t][n]}function s(i){var t=new RegExp("cmb2_n_"+i.groupid+i.fieldid,"g"),n=new RegExp("cmb2_i_"+i.groupid+i.fieldid,"g"),d,o,r;if(void 0===tinyMCEPreInit.mceInit[i.id]){for(d in o=e.extend({},i.defaults.mce))"string"==typeof o[d]&&(o[d]=o[d].replace(n,i.id).replace(t,i.name));tinyMCEPreInit.mceInit[i.id]=o}if(void 0===tinyMCEPreInit.qtInit[i.id]){for(d in r=e.extend({},i.defaults.qt))"string"==typeof r[d]&&(r[d]=r[d].replace(n,i.id).replace(t,i.name));tinyMCEPreInit.qtInit[i.id]=r}}var f=[],l=[],u=d.all={};d.initAll=function(){var n,o,r;e(".cmb2-wysiwyg-placeholder").each(function(){n=e(this),(o=n.data()).groupid&&(o.id=n.attr("id"),o.name=n.attr("name"),o.value=n.val(),d.init(n,o,!1),r=!0)}),!0===r&&(void 0!==i.QTags&&i.QTags._buttonsInit(),e(t).on("cmb2_add_row",d.addRow).on("cmb2_remove_group_row_start",d.destroyRowEditors).on("cmb2_shift_rows_start",d.shiftStart).on("cmb2_shift_rows_complete",d.shiftComplete))},d.addRow=function(i,t){d.initRow(t,i)},d.destroyRowEditors=function(i,t){d.destroy(t.parents(".cmb-repeatable-grouping").find(".wp-editor-area").attr("id"))},d.shiftStart=function(i,t,n,o){n.add(o).find(".wp-editor-wrap textarea").each(function(){d.destroy(e(this).attr("id"))})},d.shiftComplete=function(i,t,n,o){n.add(o).each(function(){d.initRow(e(this),i)})},d.initRow=function(t,o){var a,c,s;t.find(".cmb2-wysiwyg-inner-wrap").each(function(){a=e(this),c=a.data(),s=void 0!==(s=n.getFieldArg(c.hash,"default",""))&&!1!==s?s:"",c.iterator=t.data("iterator"),c.fieldid=c.id,c.id=c.groupid+"_"+c.iterator+"_"+c.fieldid,c.name=c.groupid+"["+c.iterator+"]["+c.fieldid+"]",c.value="cmb2_add_row"!==o.type&&a.find(".wp-editor-area").length?a.find(".wp-editor-area").val():s,0===f.length?d.init(a,c):(l.push([a,c]),i.setTimeout(r,100))})},d.init=function(d,o,r){if(!o.groupid)return!1;var a=n.canTinyMCE(),f="function"==typeof i.quicktags;e.extend(o,c(o)),s(o),d.replaceWith(o.template(o)),a&&i.tinyMCE.init(tinyMCEPreInit.mceInit[o.id]),f&&i.quicktags(tinyMCEPreInit.qtInit[o.id]),a&&e(t.getElementById(o.id)).parents(".wp-editor-wrap").removeClass("html-active").addClass("tmce-active"),!1!==r&&void 0!==i.QTags&&i.QTags._buttonsInit()},d.destroy=function(t){if(n.canTinyMCE()){var e=tinyMCE.get(t);null!=e?(e.destroy(),void 0===tinyMCEPreInit.mceInit[t]&&delete tinyMCEPreInit.mceInit[t],void 0===tinyMCEPreInit.qtInit[t]&&delete tinyMCEPreInit.qtInit[t]):-1===f.indexOf(t)&&(f.push(t),i.setTimeout(a,100))}},e(t).on("cmb_init",d.initAll)}(window,document,jQuery,window.CMB2,window.CMB2.wysiwyg);